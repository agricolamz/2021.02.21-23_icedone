<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3 Работа со строками и текстами | Зимняя школа АйсДан 2021: скрейпинг и анализ текстовых данных</title>
  <meta name="description" content="3 Работа со строками и текстами | Зимняя школа АйсДан 2021: скрейпинг и анализ текстовых данных" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="3 Работа со строками и текстами | Зимняя школа АйсДан 2021: скрейпинг и анализ текстовых данных" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3 Работа со строками и текстами | Зимняя школа АйсДан 2021: скрейпинг и анализ текстовых данных" />
  
  
  

<meta name="author" content="М. Серветник, А. Котликова, Ю. Мартысенко, Г. Мороз, Ф. Управителев" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="strings.html"/>
<link rel="next" href="сбор-данных-из-интернета-rvest.html"/>
<script src="libs/header-attrs-2.6/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="libs/pagedtable-1.1/js/pagedtable.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">2021 АйсДан</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> О курсе</a></li>
<li class="chapter" data-level="2" data-path="strings.html"><a href="strings.html"><i class="fa fa-check"></i><b>2</b> Работа со строками</a>
<ul>
<li class="chapter" data-level="2.1" data-path="strings.html"><a href="strings.html#работа-со-строками-в-r"><i class="fa fa-check"></i><b>2.1</b> Работа со строками в R</a></li>
<li class="chapter" data-level="2.2" data-path="strings.html"><a href="strings.html#как-получить-строку"><i class="fa fa-check"></i><b>2.2</b> Как получить строку?</a></li>
<li class="chapter" data-level="2.3" data-path="strings.html"><a href="strings.html#соединение-и-разделение-строк"><i class="fa fa-check"></i><b>2.3</b> Соединение и разделение строк</a></li>
<li class="chapter" data-level="2.4" data-path="strings.html"><a href="strings.html#количество-символов"><i class="fa fa-check"></i><b>2.4</b> Количество символов</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="strings.html"><a href="strings.html#подсчет-количества-символов"><i class="fa fa-check"></i><b>2.4.1</b> Подсчет количества символов</a></li>
<li class="chapter" data-level="2.4.2" data-path="strings.html"><a href="strings.html#подгонка-количества-символов"><i class="fa fa-check"></i><b>2.4.2</b> Подгонка количества символов</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="strings.html"><a href="strings.html#сортировка"><i class="fa fa-check"></i><b>2.5</b> Сортировка</a></li>
<li class="chapter" data-level="2.6" data-path="strings.html"><a href="strings.html#поиск-подстроки"><i class="fa fa-check"></i><b>2.6</b> Поиск подстроки</a></li>
<li class="chapter" data-level="2.7" data-path="strings.html"><a href="strings.html#изменение-строк"><i class="fa fa-check"></i><b>2.7</b> Изменение строк</a>
<ul>
<li class="chapter" data-level="2.7.1" data-path="strings.html"><a href="strings.html#изменение-регистра"><i class="fa fa-check"></i><b>2.7.1</b> Изменение регистра</a></li>
<li class="chapter" data-level="2.7.2" data-path="strings.html"><a href="strings.html#выделение-подстроки"><i class="fa fa-check"></i><b>2.7.2</b> Выделение подстроки</a></li>
<li class="chapter" data-level="2.7.3" data-path="strings.html"><a href="strings.html#замена-подстроки"><i class="fa fa-check"></i><b>2.7.3</b> Замена подстроки</a></li>
<li class="chapter" data-level="2.7.4" data-path="strings.html"><a href="strings.html#удаление-подстроки"><i class="fa fa-check"></i><b>2.7.4</b> Удаление подстроки</a></li>
<li class="chapter" data-level="2.7.5" data-path="strings.html"><a href="strings.html#транслитерация-строк"><i class="fa fa-check"></i><b>2.7.5</b> Транслитерация строк</a></li>
</ul></li>
<li class="chapter" data-level="2.8" data-path="strings.html"><a href="strings.html#определение-языка"><i class="fa fa-check"></i><b>2.8</b> Определение языка</a></li>
<li class="chapter" data-level="2.9" data-path="strings.html"><a href="strings.html#расстояния-между-строками"><i class="fa fa-check"></i><b>2.9</b> Расстояния между строками</a></li>
<li class="chapter" data-level="2.10" data-path="strings.html"><a href="strings.html#дополнительные-задания"><i class="fa fa-check"></i><b>2.10</b> Дополнительные задания:</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="strings.html"><a href="strings.html#strings"><i class="fa fa-check"></i><b>3</b> Работа со строками и текстами</a>
<ul>
<li class="chapter" data-level="3.1" data-path="strings.html"><a href="strings.html#strings-regexp"><i class="fa fa-check"></i><b>3.1</b> Регулярные выражения</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="strings.html"><a href="strings.html#strings-patterns"><i class="fa fa-check"></i><b>3.1.1</b> Паттерны</a></li>
<li class="chapter" data-level="3.1.2" data-path="strings.html"><a href="strings.html#strings-symbols"><i class="fa fa-check"></i><b>3.1.2</b> Символы</a></li>
<li class="chapter" data-level="3.1.3" data-path="strings.html"><a href="strings.html#strings-classes"><i class="fa fa-check"></i><b>3.1.3</b> Классы символов</a></li>
<li class="chapter" data-level="3.1.4" data-path="strings.html"><a href="strings.html#strings-metacharacters"><i class="fa fa-check"></i><b>3.1.4</b> Метасимволы</a></li>
<li class="chapter" data-level="3.1.5" data-path="strings.html"><a href="strings.html#strings-logic"><i class="fa fa-check"></i><b>3.1.5</b> Логические операции</a></li>
<li class="chapter" data-level="3.1.6" data-path="strings.html"><a href="strings.html#strings-quantificators"><i class="fa fa-check"></i><b>3.1.6</b> Квантификаторы</a></li>
<li class="chapter" data-level="3.1.7" data-path="strings.html"><a href="strings.html#strings-wildecards"><i class="fa fa-check"></i><b>3.1.7</b> Подстановочные знаки</a></li>
<li class="chapter" data-level="3.1.8" data-path="strings.html"><a href="strings.html#strings-anchors"><i class="fa fa-check"></i><b>3.1.8</b> Якори</a></li>
<li class="chapter" data-level="3.1.9" data-path="strings.html"><a href="strings.html#strings-groups"><i class="fa fa-check"></i><b>3.1.9</b> Группы</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="сбор-данных-из-интернета-rvest.html"><a href="сбор-данных-из-интернета-rvest.html"><i class="fa fa-check"></i><b>4</b> Сбор данных из интернета: <code>rvest</code></a>
<ul>
<li class="chapter" data-level="4.1" data-path="сбор-данных-из-интернета-rvest.html"><a href="сбор-данных-из-интернета-rvest.html#введение"><i class="fa fa-check"></i><b>4.1</b> Введение</a></li>
<li class="chapter" data-level="4.2" data-path="сбор-данных-из-интернета-rvest.html"><a href="сбор-данных-из-интернета-rvest.html#работа-с-пакетом-rvest"><i class="fa fa-check"></i><b>4.2</b> Работа с пакетом <code>rvest</code></a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="сбор-данных-из-интернета-rvest.html"><a href="сбор-данных-из-интернета-rvest.html#простой-случай"><i class="fa fa-check"></i><b>4.2.1</b> Простой случай</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="сбор-данных-из-интернета-rvest.html"><a href="сбор-данных-из-интернета-rvest.html#использование-атрибута-class"><i class="fa fa-check"></i><b>4.3</b> Использование атрибута <code>class</code></a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="сбор-данных-из-интернета-rvest.html"><a href="сбор-данных-из-интернета-rvest.html#чтение-таблиц"><i class="fa fa-check"></i><b>4.3.1</b> Чтение таблиц</a></li>
<li class="chapter" data-level="4.3.2" data-path="сбор-данных-из-интернета-rvest.html"><a href="сбор-данных-из-интернета-rvest.html#некоторые-советы"><i class="fa fa-check"></i><b>4.3.2</b> Некоторые советы</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="загрузка-текста-в-r.html"><a href="загрузка-текста-в-r.html"><i class="fa fa-check"></i><b>5</b> Загрузка текста в R</a>
<ul>
<li class="chapter" data-level="5.1" data-path="загрузка-текста-в-r.html"><a href="загрузка-текста-в-r.html#пакет-gutenbergr"><i class="fa fa-check"></i><b>5.1</b> Пакет <code>gutenbergr</code></a></li>
<li class="chapter" data-level="5.2" data-path="загрузка-текста-в-r.html"><a href="загрузка-текста-в-r.html#библиотека-tidytext"><i class="fa fa-check"></i><b>5.2</b> Библиотека <code>tidytext</code></a></li>
<li class="chapter" data-level="5.3" data-path="загрузка-текста-в-r.html"><a href="загрузка-текста-в-r.html#пакет-stopwords"><i class="fa fa-check"></i><b>5.3</b> Пакет <code>stopwords</code></a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="анализ-текста.html"><a href="анализ-текста.html"><i class="fa fa-check"></i><b>6</b> Анализ текста</a>
<ul>
<li class="chapter" data-level="6.1" data-path="анализ-текста.html"><a href="анализ-текста.html#данные"><i class="fa fa-check"></i><b>6.1</b> Данные</a></li>
<li class="chapter" data-level="6.2" data-path="анализ-текста.html"><a href="анализ-текста.html#tf-idf"><i class="fa fa-check"></i><b>6.2</b> tf-idf</a></li>
<li class="chapter" data-level="6.3" data-path="анализ-текста.html"><a href="анализ-текста.html#предиктивный-ввод-текста"><i class="fa fa-check"></i><b>6.3</b> Предиктивный ввод текста</a></li>
<li class="chapter" data-level="6.4" data-path="анализ-текста.html"><a href="анализ-текста.html#анализ-тональности"><i class="fa fa-check"></i><b>6.4</b> Анализ тональности</a></li>
<li class="chapter" data-level="6.5" data-path="анализ-текста.html"><a href="анализ-текста.html#тематическое-моделирование"><i class="fa fa-check"></i><b>6.5</b> Тематическое моделирование</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="ссылки-на-литературу.html"><a href="ссылки-на-литературу.html"><i class="fa fa-check"></i>Ссылки на литературу</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Зимняя школа АйсДан 2021: скрейпинг и анализ текстовых данных</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="strings" class="section level1" number="3">
<h1><span class="header-section-number">3</span> Работа со строками и текстами</h1>
<div id="strings-regexp" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> Регулярные выражения</h2>
<div id="strings-patterns" class="section level3" number="3.1.1">
<h3><span class="header-section-number">3.1.1</span> Паттерны</h3>
<p>В примерах к функциям <code>gsub()</code> и <code>regexpr()</code> мы упоминали и применяли особые конструкции, которые используются при обработке строковых данных - регулярные выражения. Регулярные выражения (англ. Regular Expressions, regexps)- это специальный язык для описания шаблонов строк, который используется для поиска определенных строк, проверки их на соответствие какому-либо шаблону и другой подобной работы. В функци <code>gsub()</code> и <code>regexpr()</code> мы как раз искали необходимые нам части строк с помощью паттернов (шаблонов), написанных в виде регулярнх выражений.</p>
<p>Реализация регэкспов в разных языках программирования может различаться, в R используется расширенная версия регулярных выражений (ERE, стандарт POSIX 1003.2) с некоторыми собственными дополнениями, а так же Perl-совместимые регулярные выражения (PCRE 8.36). Согласно стандарту POSIX 1003.2, длина регулярных выражений не может превышать 256 байтов. Впрочем, как показывает практика, с таким ограничением мало кто сталкивается в своей работе.</p>
<p>С регулярными выражениями есть, к сожалению, одна достаточно неприятная особенность - если выражение написано неправильно (в частности, при использовании метасимволов), то в результате, в зависимости от контекста использования, будет либо пропуск нужных элементов, либо просто отсутствие какого-либо эффекта. Поэтому есть смысл упрощать работу с регулярными выражениями, особенно если нет достаточного опыта их использования. Например, разбивать делать изменение части строки в несколько этапов, или же просто тестировать регулярные выражения небольшими блоками.</p>
</div>
<div id="strings-symbols" class="section level3" number="3.1.2">
<h3><span class="header-section-number">3.1.2</span> Символы</h3>
<p>В большинстве своем символы в регулярных выражениях обозначают сами себя, за некоторыми исключениями. Каждый символ в паттерне задает соответствие только одному символу в строке, поэтому в тех случаях, когда необходимо указать какой-то символ из определенного набора или указать, что какой-то символ повторяется некоторое количество раз подряд, следует использовать символьные классы или квантификаторы соответственно.</p>
<p>В R ряд функций для поиска и замены строк по паттерну имеют две версии - первая обрабатывает только первоей найденное значение, соответствующее паттерну, вторая версия - все найденные по паттерну значения. Например, функция <code>sub()</code> находит и заменяет первое вхождение искомого символа, <code>gsub</code> - все вхождения:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="strings.html#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># задаем строку</span></span>
<span id="cb1-2"><a href="strings.html#cb1-2" aria-hidden="true" tabindex="-1"></a>my_string <span class="ot">&lt;-</span> <span class="st">&#39;mystring998989&#39;</span></span>
<span id="cb1-3"><a href="strings.html#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="strings.html#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># удаляем символ 9, первое вхождение</span></span>
<span id="cb1-5"><a href="strings.html#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">sub</span>(<span class="st">&#39;9&#39;</span>, <span class="st">&quot;&quot;</span>, my_string)</span></code></pre></div>
<pre><code>[1] &quot;mystring98989&quot;</code></pre>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="strings.html#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># удаляем все символы `9` с помощью функции gsub() </span></span>
<span id="cb3-2"><a href="strings.html#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">gsub</span>(<span class="st">&#39;9&#39;</span>, <span class="st">&quot;&quot;</span>, my_string)</span></code></pre></div>
<pre><code>[1] &quot;mystring88&quot;</code></pre>
<p>Если в паттерне указать несколько символов, то поиск по строке будет произведен именно по такому сочетанию символов. Например, удалим из строки (заменим на пустую строку) сочетание <code>89</code>:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="strings.html#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># удаляем сочетание символов 89, первое вхождение</span></span>
<span id="cb5-2"><a href="strings.html#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sub</span>(<span class="st">&#39;89&#39;</span>, <span class="st">&quot;&quot;</span>, my_string)</span></code></pre></div>
<pre><code>[1] &quot;mystring9989&quot;</code></pre>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="strings.html#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># удаляем сочетание символов 89, все вхождения</span></span>
<span id="cb7-2"><a href="strings.html#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">gsub</span>(<span class="st">&#39;89&#39;</span>, <span class="st">&quot;&quot;</span>, my_string)</span></code></pre></div>
<pre><code>[1] &quot;mystring99&quot;</code></pre>
<p>Следует учитывать, что некоторые символы или сочетания символов могут быть проинтерпретированы либо как управляющие конструкции регулярных выражений (см. #text_metacharacters) и тогда потребуются дополнительные указания, как должны быть обработаны эти символы. Во-вторых, некоторые группы символов могут просто иметь дополнительные фиксированные значения. Так, для кодирования перехода на новую строку, табуляции и некоторых других непечатаемых символов используются определенные обозначения: <code>\n</code>, <code>\r</code>, <code>\t</code>, <code>\v</code>, <code>\f</code>. Соответственно, если в строке встретится какое-то из этих сочетаний, то строка будет прочитана и обработана не как строка, содержащая символы обратного слеша и буквы, а как строка с спец.символом (в случае с табуляцией - <code>\t</code>):</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="strings.html#cb9-1" aria-hidden="true" tabindex="-1"></a>string_with_tab <span class="ot">&lt;-</span> <span class="st">&#39;metachara</span><span class="sc">\t</span><span class="st">cters&#39;</span></span>
<span id="cb9-2"><a href="strings.html#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(string_with_tab)</span></code></pre></div>
<pre><code>metachara   cters</code></pre>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="strings.html#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># пробуем удалить из строку букву t</span></span>
<span id="cb11-2"><a href="strings.html#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">gsub</span>(<span class="st">&#39;t&#39;</span>, <span class="st">&#39;_DELETED_&#39;</span>, string_with_tab)</span></code></pre></div>
<pre><code>[1] &quot;me_DELETED_achara\tc_DELETED_ers&quot;</code></pre>
<p>Подобные символы, тем не менее, можно обрабатывать как и все прочие:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="strings.html#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gsub</span>(<span class="st">&#39;</span><span class="sc">\t</span><span class="st">&#39;</span>, <span class="st">&#39;_DELETED_&#39;</span>, string_with_tab)</span></code></pre></div>
<pre><code>[1] &quot;metachara_DELETED_cters&quot;</code></pre>
</div>
<div id="strings-classes" class="section level3" number="3.1.3">
<h3><span class="header-section-number">3.1.3</span> Классы символов</h3>
<p>Задачи на поиск конкретного символа с помощью регулярных выражений встречаются, но, в целом, стоит признать, что обычно требуется большая гибкость поиска. Например, не конкретный символ или сочетание символов, а какой-либо символ из набора - знаки пунктуации или же цифры.</p>
<p>Cамостоятельно указать какой-то набор символов с помощью квадратных скобок (стоит помнить, что квадратные скобки как метасимволы регулярных выражений и квадратные скобки в R - это разные конструкции). При этом можно либо просто перечислить все символы набора, либо, если они принадлежат какому-то известному множеству (например, цифры), то указать первый и последний элементы множества через знак дефиса (<code>-</code>). Также можно сочетать сокращенные формы записи наборов символов. Символы кириллического и латинского алфавитов - разные множества, точно также как строчные и прописные буквы.</p>
<p>Внутри классов поведение метасимволов может различаться в зависимости от места их указания в наборе символов класса. Например, <code>^</code> первым символов в наборе символов задает логическое отрицание <code>не из этих символов</code>, и чтобы избежать такого поведения, знак <code>^</code> надо поставить на любое место кроме первого в цепочке. Знак <code>]</code>, если есть необходимость его вкючения в набор символов, наоборот, надо ставить первым в наборе, в противном случае он будет проинтерпретирован как завершение класса. Знак <code>-</code>, если указан не первым и не последним, интерпретируется как знак интервала в известном диапазоне символов (например, <code>[0-9]</code> означает от <code>0</code> до <code>9</code>, а <code>[09-]</code> - символы <code>0</code>, <code>9</code> и <code>-</code>)</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="strings.html#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># задаем строку</span></span>
<span id="cb15-2"><a href="strings.html#cb15-2" aria-hidden="true" tabindex="-1"></a>my_string <span class="ot">&lt;-</span> <span class="st">&#39;D9586bNd879мрЯпп&#39;</span></span>
<span id="cb15-3"><a href="strings.html#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="strings.html#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co"># укажем, что удалить надо любую из цифр</span></span>
<span id="cb15-5"><a href="strings.html#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="fu">gsub</span>(<span class="st">&#39;[0123456789]&#39;</span>, <span class="st">&#39;&#39;</span>, my_string)</span></code></pre></div>
<pre><code>[1] &quot;DbNdмрЯпп&quot;</code></pre>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="strings.html#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gsub</span>(<span class="st">&#39;[0-9]&#39;</span>, <span class="st">&#39;&#39;</span>, my_string)</span></code></pre></div>
<pre><code>[1] &quot;DbNdмрЯпп&quot;</code></pre>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="strings.html#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># удаляем цифры, а так же строчные буквы кириллицы и латиницы</span></span>
<span id="cb19-2"><a href="strings.html#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">gsub</span>(<span class="st">&#39;[0-9a-zа-я]&#39;</span>, <span class="st">&#39;&#39;</span>, my_string)</span></code></pre></div>
<pre><code>[1] &quot;DNЯ&quot;</code></pre>
<div id="strings-classes-posix" class="section level4" number="3.1.3.1">
<h4><span class="header-section-number">3.1.3.1</span> Символьные классы в POSIX</h4>
<p>Стандарт POSIX 1003.2 поддерживает несколько определенных обозначения для часто используемых символьных классов:</p>
<ul>
<li><p><code>[:alnum:]</code>: все буквы и цифры, сочетание символьных классов <code>[:alpha:]</code> и <code>[:digit:]</code>.</p></li>
<li><p><code>[:alpha:]</code>: буквы алфавита в обоих регистрах, для прописных и строчных букв есть отдельные символьные классы: <code>[:lower:]</code> и <code>[:upper:]</code>.</p></li>
<li><p><code>[:punct:]</code>: знаки пунктуации, <code>!"#$%&amp;'()*+,-./:;&lt;=&gt;?@[\]^_`{|}~.</code>.</p></li>
<li><p><code>[:digit:]</code>: арабские цифры <code>0123456789</code>.</p></li>
<li><p><code>[:xdigit:]</code>: цифры в шестнадцатеричном формате, <code>0123456789ABCDEFabcdef</code>.</p></li>
<li><p><code>[:graph:]</code>: графические знаки, объединенный класс, состоящий из классов <code>[:alnum:]</code> и <code>[:punct:]</code>.</p></li>
<li><p><code>[:print:]</code>: печатаемые знаки, класс <code>[:graph:]</code>, дополненный пробелом.</p></li>
<li><p><code>[:blank:]</code>: непечатаемые символы (пробел, знак табуляции, в зависимости от локали - неразрывный пробел и возможные другие непечатаемые символы).</p></li>
<li><p><code>[:cntrl:]</code>: управляющие символы (в таблицах символов ANSCII коды 000-031 и 121 в десятичной, 000-037 и 177 в восьмеричной системе, 000-07F в шестнадцатеричной системах счислений)</p></li>
<li><p><code>[:space:]</code>: некоторые управляющие символы, которые используются для создания разрывов между символами - пробел, переход на новую строку, возврат каретки, перевод страницы и т.д. В зависимости от локали может содержать дополнительные знаки.</p></li>
</ul>
<p>При указании символьного класса с помощью его имени надо помнить, что обозначение класса также заключается в <code>[]</code>. То есть, вместо <code>[:digit:]</code> (обозначение класса) надо использовать <code>[[:digit:]]</code> (указание символьного класса в рег.выражении):</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="strings.html#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gsub</span>(<span class="st">&#39;[[:digit:]]&#39;</span>, <span class="st">&#39;&#39;</span>, my_string)</span></code></pre></div>
<pre><code>[1] &quot;DbNdмрЯпп&quot;</code></pre>
</div>
<div id="strings-classes-extra" class="section level4" number="3.1.3.2">
<h4><span class="header-section-number">3.1.3.2</span> Дополнительные символьные классы</h4>
<p>Помимо обозначений символьных классов, которые поддерживаются стандартом POSIX, также в R реализован ряд собственных символьных классов, которые, как правило, обозначают наиболее часто используемые комбинации:</p>
<ul>
<li><p><code>\\d</code>: цифры, аналогично <code>[0-9]</code></p></li>
<li><p><code>\\D</code>: не цифры, обратно <code>\\d</code>, аналогично <code>[^0-9]</code></p></li>
<li><p><code>\\w</code>: символы, которые используются в письме, аналогично <code>[A-z0-9_]</code></p></li>
<li><p><code>\\W</code>: обратный <code>\\w</code> набор, символы, которые не используются в письме</p></li>
<li><p><code>\\S</code>: все знаки, кроме пробела. Аналогично <code>[^[:space:]]</code> или <code>[^\\s]</code></p></li>
</ul>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="strings.html#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># задаем строку</span></span>
<span id="cb23-2"><a href="strings.html#cb23-2" aria-hidden="true" tabindex="-1"></a>my_string <span class="ot">&lt;-</span> <span class="st">&#39;D9586bNd879мрЯпп&#39;</span></span>
<span id="cb23-3"><a href="strings.html#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="strings.html#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co"># удаляем все цифры с помощью класса [0-9]</span></span>
<span id="cb23-5"><a href="strings.html#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="fu">gsub</span>(<span class="st">&#39;[0-9]&#39;</span>, <span class="st">&#39;&#39;</span>, my_string)</span></code></pre></div>
<pre><code>[1] &quot;DbNdмрЯпп&quot;</code></pre>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="strings.html#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># удаляем все цифры с помощью класса [:digit:]</span></span>
<span id="cb25-2"><a href="strings.html#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">gsub</span>(<span class="st">&#39;[[:digit:]]&#39;</span>, <span class="st">&#39;&#39;</span>, my_string)</span></code></pre></div>
<pre><code>[1] &quot;DbNdмрЯпп&quot;</code></pre>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="strings.html#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># удаляем все цифры с помощью класса \\d</span></span>
<span id="cb27-2"><a href="strings.html#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">gsub</span>(<span class="st">&#39;</span><span class="sc">\\</span><span class="st">d&#39;</span>, <span class="st">&#39;&#39;</span>, my_string)</span></code></pre></div>
<pre><code>[1] &quot;DbNdмрЯпп&quot;</code></pre>
</div>
</div>
<div id="strings-metacharacters" class="section level3" number="3.1.4">
<h3><span class="header-section-number">3.1.4</span> Метасимволы</h3>
<p>Ряд символов имеет дополнительное значение - эти символы используются не только сами по себе, но и как определенные конструкции языка регулярных выражений. В частности, это символ <code>[</code>, который используется для создания произвольного символьного класса. Полный список выглядит следующим образом:</p>
<ul>
<li><p><code>.</code>: подстановочный знак (wildcard), используется в тех случаях, когда необходимо указать, что на этом месте может быть любой знак</p></li>
<li><p><code>\</code>: используется для экранирования метасимволов</p></li>
<li><p><code>|</code> : логический оператор <code>или</code></p></li>
<li><p><code>(</code> и <code>)</code>: используются для указания групп символов</p></li>
<li><p><code>[</code>: вместе с <code>]</code> используется для указания символьных классов</p></li>
<li><p><code>^</code>: якорь, указывающий на начало строки, а так же логический оператор отрицания, используемый в символьных классах</p></li>
<li><p><code>$</code>: якорь, указывающий на конец строки</p></li>
<li><p><code>*</code>, <code>+</code> и <code>?</code> - квантификаторы, указывающие, что предыдущий символ или группа символов могут или должны повториться некоторое количество раз</p></li>
<li><p><code>{</code>: вместе с <code>}</code> исползуется как квантификатор, указывающий конкретное количество повторений предыдущего символа или группы символов</p></li>
<li><p><code>&lt;</code> и <code>&gt;</code>: используется в Perl-совместимых регулярных выражениях</p></li>
</ul>
<p>Для того, чтобы эти метасимволы воспринимались не как элементы языка регулярных выражений, а как есть, их необходимо экранировать двумя символами <code>\\</code>. Необходимость в двух символах <code>\\</code> для экранирования возникает из-за того, что строковая запись регулярного выражения в R и собственно выражение на языке регулярных выражений несколько различаются. В частности, интерпретатор R также воспринимает обратный слеш как символ экранирования:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="strings.html#cb29-1" aria-hidden="true" tabindex="-1"></a>string_with_escapes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;</span><span class="sc">\\</span><span class="st">a&#39;</span>, <span class="st">&#39;</span><span class="sc">\\</span><span class="st">z&#39;</span>, <span class="st">&#39;</span><span class="sc">\\</span><span class="st">&#39;</span>)</span>
<span id="cb29-2"><a href="strings.html#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">writeLines</span>(string_with_escapes)</span></code></pre></div>
<pre><code>\a
\z
\</code></pre>
<p>Таким образом, если мы хотим удалить из строки символы, которые могут быть проинтерпретированы как управляющие конструкции на языке регулярных выражений, мы должны либо экранировать эти символы двумя обратными слешами <code>\\</code>, либо в функции, использующей регулярное выражение, задавать аргумент <code>fixed = TRUE</code>):</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="strings.html#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># пробуем удалить символы .* без экранирования</span></span>
<span id="cb31-2"><a href="strings.html#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">gsub</span>(<span class="st">&#39;.*&#39;</span>, <span class="st">&#39;_DELETED_&#39;</span>, <span class="st">&#39;metachara.*cters&#39;</span>)</span></code></pre></div>
<pre><code>[1] &quot;_DELETED_&quot;</code></pre>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="strings.html#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># пробудем удалить с экранированием каждого символа</span></span>
<span id="cb33-2"><a href="strings.html#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="fu">gsub</span>(<span class="st">&#39;</span><span class="sc">\\</span><span class="st">.</span><span class="sc">\\</span><span class="st">*&#39;</span>, <span class="st">&#39;_DELETED_&#39;</span>, <span class="st">&#39;metachara.*cters&#39;</span>)</span></code></pre></div>
<pre><code>[1] &quot;metachara_DELETED_cters&quot;</code></pre>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="strings.html#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># используем аргумент fixed = TRUE, чтобы воспринимать паттерн не как регулярное выражение</span></span>
<span id="cb35-2"><a href="strings.html#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="fu">gsub</span>(<span class="st">&#39;.*&#39;</span>, <span class="st">&#39;_DELETED_&#39;</span>, <span class="st">&#39;metachara.*cters&#39;</span>, <span class="at">fixed =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>[1] &quot;metachara_DELETED_cters&quot;</code></pre>
</div>
<div id="strings-logic" class="section level3" number="3.1.5">
<h3><span class="header-section-number">3.1.5</span> Логические операции</h3>
<p>В регулярных выражениях логические операции представлены в достаточно ограниченном виде, можно даже сказать, крайне бедно. Наиболее очевидная из существующих операции - это <code>ИЛИ</code>, когда надо задать несколько вариантов комбинаций символов. В частности, это крайне полезный инструмент для фильтрации вектора строковых значений по определенному критерию. Например, регулярными выражениями с логическим оператором можно просто выделить из списка логов те файлы, которые были созданы в 2015-2016 годах:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="strings.html#cb37-1" aria-hidden="true" tabindex="-1"></a>models <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;log_2014.csv&#39;</span>, <span class="st">&#39;log_2015.csv&#39;</span>, <span class="st">&#39;log_2016.csv&#39;</span>, <span class="st">&#39;log_2017.csv&#39;</span>, <span class="st">&#39;log_2018.csv&#39;</span>)</span>
<span id="cb37-2"><a href="strings.html#cb37-2" aria-hidden="true" tabindex="-1"></a>models[<span class="fu">grep</span>(<span class="st">&#39;2015|2016&#39;</span>, models)]</span></code></pre></div>
<pre><code>[1] &quot;log_2015.csv&quot; &quot;log_2016.csv&quot;</code></pre>
<p>Второй логический оператор - <code>^</code>, используется в тех случаях, когда надо исключить символы определенного класса. Следует помнить, что <code>^</code> используется в этом значении сугубо внутри <code>[]</code>, в противном случае будет интерпретироваться в другом значении.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="strings.html#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># заменяем на &#39;_&#39; любой из символов d, e, f</span></span>
<span id="cb39-2"><a href="strings.html#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="fu">gsub</span>(<span class="st">&#39;[def]&#39;</span>, <span class="st">&#39;_&#39;</span>, <span class="st">&#39;fadbcdefghe&#39;</span>)</span></code></pre></div>
<pre><code>[1] &quot;_a_bc___gh_&quot;</code></pre>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="strings.html#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># заменяем на &#39;_&#39; все, кроме символов d, e, f</span></span>
<span id="cb41-2"><a href="strings.html#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="fu">gsub</span>(<span class="st">&#39;[^def]&#39;</span>, <span class="st">&#39;_&#39;</span>, <span class="st">&#39;fadbcdefghe&#39;</span>)</span></code></pre></div>
<pre><code>[1] &quot;f_d__def__e&quot;</code></pre>
</div>
<div id="strings-quantificators" class="section level3" number="3.1.6">
<h3><span class="header-section-number">3.1.6</span> Квантификаторы</h3>
<p>Для того, чтобы в паттерне указать, что какой-то символ или группа символов может повторяться, используют специальные управляющие знаки - квантификаторы:</p>
<ul>
<li><p><code>?</code>: предыдущий символ или группа символов в паттерне может встречаться 0 или 1 раз. Также вместе с другими квантификаторами используется для нежадного поиска.</p></li>
<li><p><code>*</code>: предыдущий символ или группа символов в паттерне может встречаться 0 или больше раз.</p></li>
<li><p><code>+</code>: предыдущий символ или группа символов в паттерне может встречаться 1 или больше раз.</p></li>
<li><p><code>{n}</code>: предыдущий символ или группа символов может встречаться в паттерно строго <code>n</code> раз.</p></li>
<li><p><code>{n,}</code>: предыдущий символ или группа символов может встречаться в паттерно <code>n</code> и более раз. Конструкции <code>{0,}</code> и <code>{1,}</code> тождественны <code>*</code> и <code>+</code> соответственно.</p></li>
<li><p><code>{n,m}</code>: предыдущий символ или группа символов может встречаться в паттерно <code>n</code> раз, но не более, чем <code>m</code> раз. Конструкции <code>{0,1}</code> и <code>?</code> тождественны.</p></li>
</ul>
<p>Простейший пример использования квантификаторов - когда надо обработать какой-то символ, который встречается несколько раз. Например, скрыть последние четыре цифры в номере телефона:</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="strings.html#cb43-1" aria-hidden="true" tabindex="-1"></a>phone_number <span class="ot">&lt;-</span> <span class="st">&#39;my phone number: +7-929-138-5896&#39;</span></span>
<span id="cb43-2"><a href="strings.html#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="fu">gsub</span>(<span class="st">&#39;[0-9]{4}&#39;</span>, <span class="st">&#39;XXXX&#39;</span>, phone_number)</span></code></pre></div>
<pre><code>[1] &quot;my phone number: +7-929-138-XXXX&quot;</code></pre>
</div>
<div id="strings-wildecards" class="section level3" number="3.1.7">
<h3><span class="header-section-number">3.1.7</span> Подстановочные знаки</h3>
<p>Подстановочные знаки используются в тех ситуациях, когда надо просто указать, что в этом месте может быть любой символ. Несмотря на множественное число (wildcards), в регулярных выражениях в качестве подстановочного знака используется только метасимвол <code>.</code>, который обозначает <code>любой знак</code>.</p>
<p>Обычно подстановочный знак используется в сочетании с квантификаторами, указывающими, что в этом месте может быть любое количество символов. Например, использование подстановочных знаков может помочь строку, из которой известно только несколько символов. Попробуем из списка строк выбрать только адреса электронной почты в домене ru, исходя из предположения, что требуемые адреса содержат знак <code>@</code> и сочетание <code>.ru</code>:</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="strings.html#cb45-1" aria-hidden="true" tabindex="-1"></a>emails <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;myemail@yahoo.com&#39;</span>, <span class="st">&#39;id638@yandex.ru&#39;</span>, <span class="st">&#39;simple string&#39;</span>, <span class="st">&#39;lizzy@mail.ru&#39;</span>, <span class="st">&#39;pumpkinpie@gmail.com&#39;</span>)</span>
<span id="cb45-2"><a href="strings.html#cb45-2" aria-hidden="true" tabindex="-1"></a>emails[<span class="fu">grep</span>(<span class="st">&#39;@.+</span><span class="sc">\\</span><span class="st">.ru&#39;</span>, emails)]</span></code></pre></div>
<pre><code>[1] &quot;id638@yandex.ru&quot; &quot;lizzy@mail.ru&quot;  </code></pre>
</div>
<div id="strings-anchors" class="section level3" number="3.1.8">
<h3><span class="header-section-number">3.1.8</span> Якори</h3>
<p>Якори используются для обозначения, что сочетание символов в паттерне обязательно должно начинать или завершать строку. Также есть якори, которые маркируют начало или конец не строки, а слова, однако само определение слова зависит от используемой локали. В R используются следующие якори:</p>
<ul>
<li><p><code>^</code> и <code>$</code>: начало и конец строки соответственно</p></li>
<li><p><code>\\&lt;</code> и <code>\\&gt;</code>: начало и конец слова</p></li>
<li><p><code>\\b</code>: пустая строка или края слова</p></li>
<li><p><code>\\B</code>: не край слова</p></li>
</ul>
<p>Простым примером может быть выбор и чтение только <code>xls</code>-файлов, с игнорированием <code>xlsx</code>-файлов или прочих файлов в папке. Так же при импорте файлов MS Office нередко приходится игнорировать еще и временные файлы, которые создаются при работе с файлом MS Office и обычно скрыты от пользователя (их можно отличить по символам <code>~$</code> в начале назания файла). Для этого надо указать, что в начале названия строки нет маркеров временных файлов или что название файла начинается с требуемого буквосочетания. Так же надо указать, что файл заканчивается строго на <code>xls</code>. Символы в названии, которые находятся между символами, используемыми в начале и конце строки, можно задать с помощью подстановочного знака и квантификатора (<code>.*</code>):</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="strings.html#cb47-1" aria-hidden="true" tabindex="-1"></a>files <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;report_2018.xlsx&#39;</span>, <span class="st">&#39;report2017.xlsx&#39;</span>, <span class="st">&#39;~$report2016.xls&#39;</span>, <span class="st">&#39;report2016.xls&#39;</span>, <span class="st">&#39;report2015.xls&#39;</span>, <span class="st">&#39;report2015.doc&#39;</span>)</span>
<span id="cb47-2"><a href="strings.html#cb47-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-3"><a href="strings.html#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="co"># пробуем извлечь xls-файлы c указанием якорей:</span></span>
<span id="cb47-4"><a href="strings.html#cb47-4" aria-hidden="true" tabindex="-1"></a>files[<span class="fu">grep</span>(<span class="st">&#39;^report.*xls$&#39;</span>, files)]</span></code></pre></div>
<pre><code>[1] &quot;report2016.xls&quot; &quot;report2015.xls&quot;</code></pre>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="strings.html#cb49-1" aria-hidden="true" tabindex="-1"></a>files[<span class="fu">grep</span>(<span class="st">&#39;^[^~$].*xls$&#39;</span>, files)]</span></code></pre></div>
<pre><code>[1] &quot;report2016.xls&quot; &quot;report2015.xls&quot;</code></pre>
</div>
<div id="strings-groups" class="section level3" number="3.1.9">
<h3><span class="header-section-number">3.1.9</span> Группы</h3>
<p>Квантификаторы обычно работают относительно предыдущего указанного символа. Однако нередко возникают ситуации, когда требуется провести какую-то операцию над определенной группой символов. В таких случаях используют знаки группировки - <code>(</code> и <code>)</code>. Набор символов и/или выражение, заключенные в скобки, будут восприниматься как неразрывная последовательность символов, и обрабатываться соответствующим образом.
Например, если мы хотим удалить из строки строго двукратное повторение группы символов:</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="strings.html#cb51-1" aria-hidden="true" tabindex="-1"></a>my_string <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;abRababL&#39;</span>)</span>
<span id="cb51-2"><a href="strings.html#cb51-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-3"><a href="strings.html#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="co"># пробуем удалить пару символов без указания группы</span></span>
<span id="cb51-4"><a href="strings.html#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="fu">gsub</span>(<span class="st">&#39;ab&#39;</span>, <span class="st">&#39;_DELETED_&#39;</span>, my_string)</span></code></pre></div>
<pre><code>[1] &quot;_DELETED_R_DELETED__DELETED_L&quot;</code></pre>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="strings.html#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># группируем символы с помощью ()</span></span>
<span id="cb53-2"><a href="strings.html#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="fu">gsub</span>(<span class="st">&#39;(ab){2}&#39;</span>, <span class="st">&#39;_DELETED_&#39;</span>, my_string)</span></code></pre></div>
<pre><code>[1] &quot;abR_DELETED_L&quot;</code></pre>
<p>При необходимости всю обрабатываемую строку можно, с помощью символьных классов, групп и прочих инструментов регулярных выражений, представить в паттерне. При подобном представлении группы нумеруются и может быть обработана конкретная группа символов, вызванная по номеру. Номера групп обозначаются как <code>\\1</code>-<code>\\9</code>.</p>
<p>Например, в строке есть как текст, так и номер телефона, и мы хотим извлечь все, кроме текста и кода страны. Для этого мы пишем паттерн, который описывает всю строку, и необходимые нам части строки представляем в виде групп. Далее с помощью <code>gsub()</code> мы изменяем исходную строку так, что в ней остаются только требуемые нам группы из кодирующих телефонный номер:</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="strings.html#cb55-1" aria-hidden="true" tabindex="-1"></a>phone_number <span class="ot">&lt;-</span> <span class="st">&#39;my phone number: +7-929-138-58-96&#39;</span></span>
<span id="cb55-2"><a href="strings.html#cb55-2" aria-hidden="true" tabindex="-1"></a>phone_number <span class="ot">&lt;-</span> <span class="st">&#39;my phone number: +7-929-1385896&#39;</span></span>
<span id="cb55-3"><a href="strings.html#cb55-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-4"><a href="strings.html#cb55-4" aria-hidden="true" tabindex="-1"></a>phone_pattern <span class="ot">&lt;-</span> <span class="st">&#39;.+(</span><span class="sc">\\</span><span class="st">+[0-9]*)-?([0-9]{3})-?([0-9]{3})-?([0-9]{2})-?([0-9]{2})&#39;</span></span>
<span id="cb55-5"><a href="strings.html#cb55-5" aria-hidden="true" tabindex="-1"></a><span class="fu">gsub</span>(phone_pattern, <span class="st">&#39;</span><span class="sc">\\</span><span class="st">2-</span><span class="sc">\\</span><span class="st">3-</span><span class="sc">\\</span><span class="st">4</span><span class="sc">\\</span><span class="st">5&#39;</span>, phone_number)</span></code></pre></div>
<pre><code>[1] &quot;929-138-5896&quot;</code></pre>
<p>В примере выше конструкция <code>.+</code> обозначает все возможные символы до группы <code>(\\+[0-9]*)</code>, которая, в свою очередь, обозначает численный код страны. Код страны может сстоять как из одной цифры, так и из нескольких. Конструкция <code>-?</code> нужна для того, чтобы учесть ситуации, когда номер телефона записывается с разделителями, расставленными в произвольном порядке (<code>+7-929-138-5896</code> vs <code>+79291385896</code> vs <code>+7-929-138-58-96</code> и т.д.). Группы <code>([0-9]{3})</code>, <code>([0-9]{2})</code> обозначают, собственно, сколько раз должны повторяться цифры в этой группе символов.</p>
<p>В результате в паттерне оказывается представлена вся строка, а элементы номера телефона представлены в виде пяти групп. Функция <code>sub()</code> находит в строке совпадение с паттерном и замещает строку на набор групп, <code>\\2-\\3-\\4\\5</code>, притом, четвертая и пятая группы сознательно не разделены знаком <code>-</code>, чтобы в результате последние четыре цифры номера были целостным блоком. Так как паттерн кодирует всю строку, то, в результате мы получаем только те части строки, которые описываются группами. В нашем случае это номер телефона без указания кода страны.</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="strings.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="сбор-данных-из-интернета-rvest.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/agricolamz/2021.02.21-23_icedone/edit/master/02-regular-expressions.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
},
"self_contained": true
});
});
</script>

</body>

</html>
